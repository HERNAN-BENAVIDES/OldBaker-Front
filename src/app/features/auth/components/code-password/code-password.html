<div class="verify-page">
  <div class="verify-card" role="main" aria-labelledby="verify-title">
    <header class="verify-header">
      <div class="icon-circle" aria-hidden="true">🔒</div>
      <div class="header-text">
        <h2 id="verify-title">Recuperar contraseña</h2>
        <p class="subtitle">Introduce el código de 6 dígitos que te enviamos por correo</p>
      </div>
    </header>

    <p class="hint">Se envió el código a: <strong class="email">{{ emailToShow || resetEmail || 'tu correo' }}</strong></p>

    <form [formGroup]="codeForm" (ngSubmit)="onSubmit()" novalidate autocomplete="off">
      <p class="sr-only" aria-hidden="true">Código de recuperación, 6 dígitos</p>

      <div class="otp-wrapper" (paste)="onPaste($event)" aria-label="Código de recuperación">
        <div *ngFor="let i of indices" class="otp-cell">
          <input #otp
                 class="otp-digit"
                 type="tel"
                 inputmode="numeric"
                 maxlength="1"
                 [attr.aria-label]="'Dígito ' + (i + 1)"
                 (input)="onInput($event, i)"
                 (keydown)="onKeyDown($event, i)" />
        </div>
      </div>

      <div class="error" *ngIf="codigo?.touched && codigo?.invalid">
        <span *ngIf="codigo?.errors?.['required']">El código es obligatorio.</span>
        <span *ngIf="codigo?.errors?.['pattern']">El código debe tener 6 dígitos numéricos.</span>
      </div>

      <div class="actions">
        <button class="btn primary" type="submit" [disabled]="isLoading">{{ isLoading ? 'Verificando...' : 'Verificar' }}</button>
        <button type="button" class="btn ghost" (click)="router.navigate(['/'])" aria-label="Cancelar">Cancelar</button>
      </div>

      <div class="resend-row">
        <span>¿No recibiste el código?</span>
        <button type="button" class="link" (click)="resendCode()">Reenviar código</button>
      </div>
    </form>
  </div>
</div>
